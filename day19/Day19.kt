import java.util.*

fun gridOf(input: String): List<CharArray> {
    return input.lines().dropLast(1).map { it.toCharArray() }
}

class Vector2(val x: Int, val y: Int) {
    fun next(direction: Direction) = when(direction) {
            Direction.NORTH -> Vector2(x, y-1)
            Direction.SOUTH -> Vector2(x, y+1)
            Direction.EAST -> Vector2(x+1,y)
            Direction.WEST -> Vector2(x-1,y)
        }

    override fun toString(): String {
        return "[x=$x,y=$y]"
    }

    fun isInvalid(grid: List<CharArray>) =
        x < 0 || y < 0 || y >= grid.size || x >= grid[0].size
}

enum class Direction {
    NORTH,
    SOUTH,
    EAST,
    WEST
}

fun main(args: Array<String>) {
    var demo = traverse(demoInput)
    asrt(demo.first == "ABCDEF" && demo.second == 38, "demo input fails: $demo")
    println("Demo terminated with $demo")
    val puzzle = traverse(puzzleInput)
    println("Puzzle terminated with $puzzle")
}

operator fun List<CharArray>.get(v: Vector2): Char {
    if(v.y >= this.size) {
        return ' '
    }
    if(v.x >= this[0].size) {
        return ' '
    }
    return this[v.y][v.x]
}

fun asrt(b: Boolean, msg: String) {
    if(!b) {
        throw Exception(msg)
    }
}

fun traverse(input: String): Pair<String, Int> {
    var stepCounter = 0
    val grid = gridOf(input)
    val start = Vector2(grid[0].indexOf('|'), 0)
    val letterCollection = mutableListOf<Char>()
    var direction = Direction.SOUTH
    var position = start
    val current = grid[position]
    println(current)
    while(true) {
        val oldCh = grid[position]
        if(!position.isInvalid(grid)) {
            if(oldCh == ' ') {
                println("We stepped on a space. Terminating at $position")
                return Pair(letterCollection.joinToString(""), stepCounter)
            }
            asrt(oldCh != ' ', "unexpected space @ $position")
        }
        val nextPos = position.next(direction)
        //println("$position -> $nextPos  @  $direction")
        if(nextPos.isInvalid(grid)) {
            println("Next step $nextPos is invalid. Letters collected. ${letterCollection.joinToString("")}")
            return Pair(letterCollection.joinToString(""), stepCounter)
        }
        stepCounter++
        val ch = grid[nextPos]
        position = nextPos
        if(ch == '+') {
            //todo: we need to handle a turn
            println("encountered turn")

            when(direction) {
                Direction.SOUTH, Direction.NORTH -> {
                    //we need to check east and west, see where that gets us
                    val east = grid[position.next(Direction.EAST)]
                    val west = grid[position.next(Direction.WEST)]
                    if(!east.isWhitespace()) {
                        //we can go east. this is out new destination.
                        direction = Direction.EAST
                    }
                    else {
                        asrt(!west.isWhitespace(), "west should not be whitespace if we step on it")
                        //we _should be able to_ go west.
                        direction = Direction.WEST
                    }
                }
                Direction.EAST, Direction.WEST -> {
                    //we are moving laterally, so we need to check north and south
                    val north = grid[position.next(Direction.NORTH)]
                    val south = grid[position.next(Direction.SOUTH)]
                    if(!north.isWhitespace()) {
                        direction = Direction.NORTH
                    }
                    else {
                        asrt(!south.isWhitespace(), "south should not be whitespace if we step on it")
                        direction = Direction.SOUTH
                    }
                }
            }
            println("New direction: $direction")
        }
        if(ch.isLetter()) {
            println("Encountered $ch")
            //we collect the letter
            letterCollection.add(ch)
        }
        if(ch.isWhitespace()) {
            println("There was a problem at $position, letters collected: ${letterCollection.joinToString("")}")
        }

    }
}




val demoInput =
        "     |          \n" +
        "     |  +--+    \n" +
        "     A  |  C    \n" +
        " F---|----E|--+ \n" +
        "     |  |  |  D \n" +
        "     +B-+  +--+ \n"


private val puzzleInput =
        "                                                                                                                 |                                                                                       \n" +
        "               +-+ +---------+     +-------------+                                   +---------------------------|-+         +-------------------------------------------+             +---------+       \n" +
        "               | | |         |     |             |                                   |                           | |         |                                           |             |         |       \n" +
        "           +-------|---------------|-------------------------------------------------|-----+                     | |         |         +---------+                       | +-----------|-------+ +-----+ \n" +
        "           |   | | |         |     |             |                                   |     |                     | |         |         |         |                       | |           |       |       | \n" +
        "           |   | +-------------------------------+               +-------------------------|---------------------|-------------------------------|-----------------------|-------------|---+   |       | \n" +
        "           |   |   |         |     |                             |                   |     |                     | |         |         |         |                       | |           |   |   |       | \n" +
        "           |   |   |     +---------------------------------------|-------------------------|-------------+       | | +-+     +-------------------------------+           | |           |   |   |       | \n" +
        "           |   |   |     |   |     |                             |                   |     |             |       | | | |               |         |           |           | |           |   |   |       | \n" +
        "       +---|---|---|-----+   |     |                             |               +---|-------------------|-------|---|-----------------|---------|-----------------------|-------------|---|-+ +-+     | \n" +
        "       |   |   |   |         |     |                             |               |   |     |             |       | | | |               |         |           |           | |           |   | |   |     | \n" +
        "       |   |   | +-----------------|---------+                   |               |   |     |     +-------|---------|-|-----------------+         |           |           | |         +-|---|---------+ | \n" +
        "       |   |   | | |         |     |         |                   |               |   |     |     |       |       | | | |                         |           |           | |         | |   | |   |   | | \n" +
        "       |   |   | | |         |     |         |                   |               |   |     |     |       |       | | +-|-------------------------------------------------|-|-----------|-----|-------+ | \n" +
        "       |   |   | | |         |     |         |                   |               |   |     |     |       |       | |   |                         |           |           | |         | |   | |   |     | \n" +
        "       |   |   | | |     +---|-----|---------|---------------------------------------|-----------|-------|-------|-|-----------------------------------------+ +-+       | |         | |   | |   |     | \n" +
        "       |   |   | | |     |   |     |         |                   |               |   |     |     |       |       | |   |                         |             | |       | |         | |   | |   |     | \n" +
        "       |   |   | | |     |   |   +-----+     |                   |               |   |     |     |       |     +-|-|---|-------------------------|-----------------------|-----+     | |   | |   |     | \n" +
        "       |   |   | | |     |   |   | |   |     |                   |               |   |     |     |       |     | | |   |                         |             | |       | |   |     | |   | |   |     | \n" +
        " +---------|-------|-------------|-|---|-------------+           |               |   |     |     |       |     | | |   +---------------------------------------|-|-------|-----|-+   | |   | |   +---+ | \n" +
        " |     |   |   | | |     |   |   | |   |     |       |           |               |   |     |     |       |     | | |                             |             | |       | |   | |   | |   | |       | | \n" +
        " |     |   +---|-|-|---------|-----|-----+   |       +-------------------------+ |   |     +---------------------|-|-----------------------------|-------------|---------|-|-----|---|-----|-+       | | \n" +
        " |     |       | | |     |   |   | |   | |   |                   |             | |   |           |       |     | | |                             |             | |       | |   | |   | |   |         | | \n" +
        " |     |       | | |     |   |   | |   | |   |                   |             | |   |           +-------|-------|-------------------------------|---------------|-+     | |   | |   | |   | +-----+ | | \n" +
        " |     |       | | |     |   |   | |   | |   |                   |             | |   |                   |     | | |                             |             | | |     | |   | |   | |   | |     | | | \n" +
        " |     |       | | |     |   |   | |   | |   |                   |             | |   |                   |     | | |                             |             | | |     | |   | |   | | +-|-+     | | | \n" +
        " |     |       | | |     |   |   | |   | |   |                   |             | |   |                   |     | | |                             |             | | |     | |   | |   | | | |       | | | \n" +
        " |     |       | | |     |   |   | |   | |   |                   |             | |   |         +---------------|-|-----------------------------------------------|-|-----------------------------+ +-|-+ \n" +
        " |     |       | | |     |   |   | |   | |   |                   |             | |   |         |         |     | | |                             |             | | |     | |   | |   | | | |     |   |   \n" +
        " |     |       | | |     |   +---|-|---|-|---|-------+ +-+       |             | |   |         |         |     | | +-----------------+           |             | | |     | |   | |   | | | | +-----+ | S \n" +
        " |     |       | | |     |       | |   | |   |       | | |       |             | |   |         |         |     | |                   |           |             | | |     | |   | |   | | | | |   | | | | \n" +
        " |   +-----------|-------|-------|-----|-----|---------------------------------------------+   |         |     | |                   |           |             | | |     | |   | |   | | | | |   | | | | \n" +
        " |   | |       | | |     |       | |   | |   |       | | |       |             | |   |     |   |         |     | |                   |           |             | | |     | |   | |   | | | | |   | | | | \n" +
        " |   | |       | | |   +-|-------|-|-----|---|---------|-+ +-----|-------------|-----------|---|---------+     | |                   |           |             | | | +---|-------|---|-|---|-|---|-|---+ \n" +
        " |   | |       | | |   | |       | |   | |   |       | |   |     |             | |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | +-|-----+   | | |   +-|---------|-------------+   | |   |     |             | |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | | |   |   | | |     |       | |   | |   |   |   | |   |     |             | |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | | +---|---+ | +-------------------|-|-------|-----------------------------+ |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     |       |       | |   | |   |   |   | |   |     |               |   |     |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     |       | +-----|-|---------|---|---|-|---|-----|---------------|-----+   |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     |       | |     | |   | |   |   |   | |   |     |               |   | |   |   |               | |                   |           |             | | | |   | |   | |   J | | | |   | | |   \n" +
        " | | |     |     | +---------+   | |   | |   |   |   | |   |     |               |   | |   |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     | |     | | |   | |   | |   |   |   | |   |     |               |   | |   |   |               | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     | |     +---------|---|-|-----------|-|---|-----|-------------------|-----|---|---------+     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     | |       | |   | |   | |   |   |   | |   |     |               |   | |   |   |         |     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     | |       | |   | |   | |   |   |   | |   |     |       +-------|---|-|-----+ |         |     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     | |       | |   | |   | |   |   |   | |   |     |       |       |   | |   | | |         |     | |                   |           |             | | | |   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     | |       +-|---|-------|---|---|---|-----|-----+ +-----|-----------|-|---|-------------|-----|-+ +-----------------------------|-------------|-----+   | |   | |   | | | | |   | | |   \n" +
        " | | |     |     | |         |   | |   | |   |   |   | |   |       |     |       |   | |   | | |         |     |   |                 |           |             | | |     | |   | |   | | | | |   | | |   \n" +
        " | | |     +---------------------|-----|-|-------------|-----------|-------------|---|-|---|-+ |         |     |   |                 |           |             | | |   +-------|---+ | | | | |   | | |   \n" +
        " | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |           |             | | |   | | |   | | | | | | | |   | | |   \n" +
        " | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |           |             | | |   | | |   | | | | | | | |   | | |   \n" +
        " | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |           |             | | |   | | |   | | | | | | | |   | | |   \n" +
        " | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |     +-------------------|-----------|---|-|-|-----+ | |   | | |   \n" +
        " | | |           | |         |   | |   | |   |   |   | |   |       |     |       |   | |   |   |         |     |   |                 |     |     |             | | |   | | |   | | | | |   | |   | | |   \n" +
        " | | |           | +---------|-----|---|-|---|---|-----+   |       |     |       |   | +---|-------------|---------------------------|----E|-+   |             | | |   | | |   | | | | |   | |   | +-+   \n" +
        " | | |           |           |   | |   | |   |   |   |     |       |     |       |   |     |   |         |     |   |                 |     | |   |             | | |   | | |   | | | | |   | |   |       \n" +
        " | | |           |     +---+ |   | |   | |   |   |   |   +---------|-----|-----------------|---|---------|---------------------------+     | |   |             | | |   | | |   | | | | |   | |   |       \n" +
        " | | |           |     |   | |   | |   | |   |   |   |   | |       |     |       |   |     |   |         |     |   |                       | |   |             | | |   | | |   | | | | |   | |   |       \n" +
        " | | |           |     |   | |   | |   | |   | +---------|---------------|---------------------|---------|-----+   |                       | |   |             | | |   | | |   | | | | |   | |   |       \n" +
        " | | |           |     |   | |   | |   | |   | | |   |   | |       |     |       |   |     |   |         |         |                       | |   |             | | |   | | |   | | | | |   | |   |       \n" +
        " | +-------------|-----|---|-----|-----|-----|-|-----|-----|-------|-----|-----------|---------|-------------------|-----------------------|-|-----------------+ | |   | | |   | | | | |   | |   |       \n" +
        " |   |           |     |   | |   | |   | |   | | |   |   | |       |     |       |   |     |   |         |         |                       | |   |               | |   | | |   | | | | |   | |   |       \n" +
        " |   |           |     |   | |   | |   | |   | | |   | +-|---------------|-----------|-----|---|-------------------------------------------|-----|-+             | |   | | |   | | | | |   | |   |       \n" +
        " |   |           |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | |   | | | | |   | |   |       \n" +
        " |   |           |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | |   | | | | |   | |   |       \n" +
        " |   |           |     |   | |   | |   | |   | | |   T | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | |   | | | | |   | |   |       \n" +
        " |   |         +-|-----|-----|---|-|---|---------|-----|-----------|-----|-------|---|---------|-------------------------------------------|-|---|-|-------------|-------|---+ | | | | |   | |   |       \n" +
        " |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       \n" +
        " |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       \n" +
        " |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       \n" +
        " |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       \n" +
        " |   |         | |     |   | |   | |   | |   | | |   | | | |       |     |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |       \n" +
        " |   | +-------|-|-+   |   | |   | |   | |   | | |   | | | |       | +---|-------|---|-----|---|-------------------|-----------------------|-------------------------------|-|-|-|---|---------------+   \n" +
        " |   | |       | | |   |   | |   | |   | |   | | |   | | | |       | |   |       |   |     |   |         |         |                       | |   | |             | |   | | | | | | | | |   | |   |   |   \n" +
        " |   | |       | | |   |   | |   | |   | |   | | |   | +-------------|---------------|---------+         |         |                       | |   | |             | |   | | | | | | | | |   | |   |   |   \n" +
        " |   | |       | | |   |   | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   | |             | |   | | | | | | | | |   | |   |   |   \n" +
        " |   | |       | | |   | +-|-|-----------|-----|---------|-|-------|-|---|-----------------|-------------|---------|-----------------------|-----|-|---------------|-----|-+ | | | | | +---+ |   |   |   \n" +
        " |   | |       | | |   | | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   | |             | |   | |   | | | | |       |   |   |   \n" +
        " |   | |       | | |   +-----|---|-------------------|---|---------|-----|-----------|-----------------------------|-------------------------|-----+             | |   | |   | | | | |       |   |   |   \n" +
        " |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   \n" +
        " |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   \n" +
        " |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   \n" +
        " |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   \n" +
        " |   | |       | | |     | | |   | |   | |   | | |   |   | |       | |   |       |   |     |             |         |                       | |   |               | |   | |   | | | | |       |   |   |   \n" +
        " |   | |       | | |     | | +-----|---|-|-----------------|-------|-|---------------------------------------------+                       | |   |               | |   | |   | | | | |       |   |   +-+ \n" +
        " |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |       |   |     |             |                                 | |   |               | |   | |   | | | | |       |   |     | \n" +
        " |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |       +---------|-------------|-------------+                   | +---|---------------|-|---------+ | +-------------+ |     | \n" +
        " |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |             |             |                   |     |               | |   | |     |   | |       | | |     | \n" +
        " |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |             +-------------|---------+         |     |     +-----+   | |   | |     |   | |       | | |     | \n" +
        " |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |         |         |     |     |     |   | |   | |     |   | |       | | |     | \n" +
        " |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   +-----|---------|-----------|-----|---------|-------------|---------------+ | \n" +
        " |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   |     |         |     |     |     |   | |   | |     |   | |       | | |   | | \n" +
        " |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   |     |         |     |     | +-------|-------|-----------------------|-----+ \n" +
        " |   | |       | | |     | |     | |   | |   | | |   |   | |       | |   |           |     |                           |   |     |         |     |     | |   |   | |   | |     |   | |       | | |   |   \n" +
        " |   | |       | | |     | |   +---+   | |   | | |   |   +-----------|---|---------------------------------------------|---|---------------|-----------|-|---|---|-----|-|-----|---|-----------|-----|-+ \n" +
        " |   | |       | | |     | |   | |     | |   | | |   |     |       | |   |           |     |                           |   |     |         |     |     | |   |   | |   | |     |   | |       | | |   | | \n" +
        " |   | |       | | |     | | +-----+   | |   | | |   |     +-------|-----|-----------|---------+                       |   |     |         | +-------------+ |   | |   | |     |   | |       | | |   +-+ \n" +
        " |   | |       | | |     | | | | | |   | |   | | |   |             | |   |           |     |   |                       |   |     |         | |   |     | | | |   | |   | |     |   | |       | | |       \n" +
        " |   | |     +---|-------+ | | | | |   | |   | | |   | +-------------|---|-----------|-----|---|-----------------------|---|-----|---------|-|---|-----+ | | |   | +-----------------------+ | | |   +-+ \n" +
        " |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       |   |     |         | |   |       | | |   |     | |     |   | |     | | | |   | | \n" +
        " |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | +-|-----|---------|-|---|-------|-|-----------|-|---------|-|-----|---+ |   | | \n" +
        " |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | |     |         | |   |       | | |   |     | |     |   | |     | |   |   | | \n" +
        " |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | +---|---+     | |   |       | | |   |     | |     |   | |     | |   |   | | \n" +
        " |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | |   |   |     | |   |       | | |   |     | |     |   | |     | |   |   | | \n" +
        " |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | |   |   |     | |   |       | | |   |     | |     |   | |     | |   | +-+ | \n" +
        " |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |                       | | | |   |   |     | |   |       | | |   |     | |     |   | |     | |   | |   | \n" +
        " |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |               +-----------|-----|---|---+ +-|---|-----+ | | |   |     | |     |   | +-----+ |   | |   | \n" +
        " |   | |     | | | |       | | | | |   | |   | | |   | |           | |   |           |     |   |               |       | | | |   |   |   |   |   |     | | | |   |     | |     |   |         |   | |   | \n" +
        " |   | |     +---------------|-|-|-|-----|---|-|-|-------------------+   |           |     +-------------------|---------|---------------|---|---|-----------|---------+ |     |   |         |   | |   | \n" +
        " |   | |       | | |       | | | | |   | |   | | |   | |           |     |           |         |               |       | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |   | \n" +
        " |   | |       | | |       | | | | |   | |   | | |   | |           |     |           |         |               |       | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |   | \n" +
        " |   | |       | | |       | | | | |   | |   | | |   | |           |     |           |         |               |       | | | |   |   |   |   |   |     | M | |   |       |     |   |         |   | |   | \n" +
        " |   | |       | | |     +---|-|---|---|---------|-----+           |     |           |         |               |     +-|---|-|---|-----------|---|-----|-|---|-----------------------------------|-----+ \n" +
        " |   | |       | | |     | | | | | |   | |   | | |   |             |     |           |         |               |     | | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |     \n" +
        " |   | |       | | |     | | | | | |   | |   | | |   |             |     |           |         |               |     | | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |     \n" +
        " |   | |       | | |     | | | | | |   | |   | | |   |             |     |           |         |               |     | | | | |   |   |   |   |   |     | | | |   |       |     |   |         |   | |     \n" +
        " +-------------|---------|---|---|-----------|-|-----|---------+   |     |         +-|-+ +-----|---------------|-----|-------|---|---|---|---------+   | | | |   |       |     |   |         |   | |     \n" +
        "     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |               |     | | | | |   |   |   |   |   | |   | | | |   |       |     |   |         |   | |     \n" +
        "     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       +---------------|-|---|---------------------|-------|-+   |       |     |   |         |   | |     \n" +
        "     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | |     |       |     |   |         |   | |     \n" +
        "     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | |     |       |     |   |   +-----+ +-------+ \n" +
        "     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | |     |       |     |   |   |       | | |   | \n" +
        "     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | | +-----|-+     |     |   |   |       | | |   | \n" +
        "     | |       | | |     | | | | | |   | |   | | |   |         |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |       | |     |     |   |   |       | | |   | \n" +
        "     | |       | | |     | | | | | | +---------|-+   | +-------|---------|-------------|-|-------------|-------------------------|---|---|---|---|-------|-----+ +-+     |   +---------------+ | | |   | \n" +
        "     | |       | | |     | | | | | | | | |   | |     | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |   |   |     | | | |   | \n" +
        "     | |       | | |     | | | | +---|G--+   | |     | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |   |   |     | | | |   | \n" +
        "     | |       | | |     | | | |   | | |     | |     | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |   |   |     | | | |   | \n" +
        "     | |       | | |     | | | |   | | |     | |   +-|-|-----------|---------------|-----|-------------|-------|-----|-|-|-|-----|-----------|-----------|---------------|---|-|---+   |     | | | |   | \n" +
        "     | |       | | |     | | | |   | | |     | |   | | |       |   |     |         | | | |     |       |       |     | | | | |   |   |   |   |   | |   | |     |         |   | |       |     | | | |   | \n" +
        "     | |       | | | +---|-|-|-+   | | |     | |   | | |       |   |     |         | | | +-----|-------|-------+     | +-----|---|-----------|-----|-----------|-------------|-|---------+   | | | |   | \n" +
        "     | |       | | | |   | | |     | | |     | |   | | |       |   |     |         | | |       |       |             |   | | |   |   |   |   |   | |   | |     |         |   | |       | |   | | | |   | \n" +
        "     | |       | | | |   | | |     | | +-------|-------|---------------------------|-------------------|-------------------|-----|---------------------|-|-----|-------------|-|-------------|---|-|-+ | \n" +
        "     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             |   | | |   |   |   |   |   | |   | |     |         |   | |       | |   | | | | | | \n" +
        "     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             |   | | | +-----------------|-+   | |     |         |   | |       | |   | | | | | | \n" +
        "     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             |   | | | | |   |   |   |   |     | |     |         |   | |       | |   | | | | | | \n" +
        "     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             | +-------|-----|---+   |   |     | +-----|---------|---|-------+ | |   | | | | | | \n" +
        "     | |       | | | |   | | |     | |       | |   | | |       |   |     |         | | |       |       |             | | | | | | |   |       |   |     |       |         |   | |     | | |   | | | | | | \n" +
        "     | |       | | | |   | | |     | |       | |   | | |       |   |     +-------------+       |       |             | | | | | | |   |       |   |     |       |         |   | |     | | |   | | | | | | \n" +
        "     | |       | | | |   | | |     | |       | |   | | |       |   |               | |         |       |             | | | | | | |   |       |   |     |       |         |   | |     | | |   | | | | | | \n" +
        "     | |       | | | |   | +----------------P--|-+ | | |       |   |               | |         |       |             | | | | | | |   | +---------------|-------+         |   | |     | | |   | | | | | | \n" +
        "     | |       | | | |   |   |     | |       | | | | | |       |   |               | |         |       |             | | | | | | |   | |     |   |     |                 |   | |     | | |   | | | | | | \n" +
        "     | |       | | | |   |   |     | |       | | | | | |       |   |               | | +-------|---------------------|-|-----|---|-----|-----|---------|-------------------+ | |     | | |   | | | | | | \n" +
        "     | |       | | | |   |   |     | |       | | | | | |       |   |               | | |       |       |             | | | | | | |   | |     |   |     |                 | | | |     | | |   | | | | | | \n" +
        "     | |       | | | |   |   |     | |       | | | | | |       |   |               | | |       |       |             | +---|-|---|---|-|-----|-----------------+         | | | |     | | |   | | | | | | \n" +
        "     | |       | | | |   |   |     | |       | | | | | |       |   |               | | |       |       |             |   | | | | |   | |     |   |     |       |         | | | |     | | |   | | | | | | \n" +
        "     | |   +---+ | | |   |   |     | |       | | | | | |       |   |             +-|-|-|---------------|-------------------+ | | |   | |     |   | +---|-------+         | | | |     | | |   | | | | | | \n" +
        "     | |   |     | | |   |   |     | |       | | | | | |       |   |             | | | |       |       |             |   |   | | |   | |     |   | |   |                 | | | |     | | |   | | | | | | \n" +
        "     | |   |     | | |   |   |   +---|---------|-|-|-|---------|---|-----------------|-----------------------------------------|-----|-|-----|---|-|-------+ +-----+ +---|-----|-+ +-|-|---------|---|-+ \n" +
        "     | |   |     | | |   |   |   | | |       | | | | | |       |   |             | | | |       |       |             |   |   | | |   | |     |   | |   |   | |     | |   | | | | | | | | |   | | | | |   \n" +
        "     | |   |     | | |   |   |   | | |       | | | | | |       |   |             | | | |       |       |             |   +-----|-|-----|-----|---|-|---------|-----+ |   | | | | | | | | |   | | | | |   \n" +
        "     | |   |     | | |   |   |   | | |       | | | | | |       |   |             | | | |       |       |             |       | | |   | |     |   | |   |   | |       |   | | | | | | | | |   | | | | |   \n" +
        "     | |   |     +-|---------|-----|---------|---|-|---|-------|-----+           | | | |       |       |             | +---+ | | |   | |     +---|-|---------------------|---|-----|-|-|-|-----+ | | |   \n" +
        "     | |   |       | |   |   |   | | |       | | | | | |       |   | |           | | | |       |       |             | |   | | | |   | |         | |   |   | |       |   | | | | | | | | |   |   | | |   \n" +
        "     | |   |       | |   |   |   | | |       | | | | | |       |   | |           | | +-------------------------------|-|-+ | | | |   | |         | |   |   +-|-+     |   | | | | | | | | |   |   | | |   \n" +
        "     | |   |       | |   |   |   | | |       | | | | | |       |   | |           | |   |       |       |             | | | | | | |   | |         | |   |     | |     |   | | | | | | | | |   |   | | |   \n" +
        "   +---------------|-|---|-------|-|---------|---|-|-|-|-------------|-----------|-----|-------|---------------------|-|---|-|---------|---------|-|---|-----|-----------|-----|---|---|-|-------------+ \n" +
        "   | | |   |       | |   |   |   | | |       | | | | | |       |   | |           | |   |       |       |             | | | | | | |   | |         | |   |     | |     |   | | | | | | | | |   |   | | | | \n" +
        "   | | |   | +-+   | |   |   +---|-|-+       | | | | | +---------------------------|---|-------|-------|----------K----|---|---|-----+ |         +-------------+     |   +---+ | | +-+ | |   |   | | | | \n" +
        "   | | |   | | |   | |   |       | |         | | | | |         |   | |           | |   |       |       |             | | | | | | |     |           |   |     |       |     |   | |     | |   |   | | | | \n" +
        "   | | |   | | |   +-|-----------|-----------|-|-----------------------------------|-----------|-----------------------|-|-|-|---------|---------------|-------------------|---|-------|-+   |   +---|-+ \n" +
        "   | | |   | | |     |   |       | |         | | | | |         |   | |           | |   |       |       |             | | | | | | |     |           |   |     |       |     |   | |     |     |     | |   \n" +
        "   | | |   | | |     |   |       | |         +-|---|-|---------------------------|-|-----------|-------------------------|---+ | |     |           |   |     +-+   +-+     |   | |     |     |   +-----+ \n" +
        "   | | |   | | |     |   |       | |           | | | |         |   | |           | |   |       |       |             | | | |   | |     |           |   |       |   |       |   | |     |     |   | | | | \n" +
        "   | | |   | | |     |   |       | +-----------|-----|---------|---|-------------|-----|-------|---------------------|-|-|-+   | |     |           |   |       |   |       |   | |     |     |   | | | | \n" +
        "   | | |   | | |     |   |       |             | | | |         |   | |           | |   |       |       |             | | |     | |     |           |   |       |   |       |   | |     |     |   | | | | \n" +
        "   +-|-+   | | |     |   |       |             | | | |         |   | |           | |   |       |       | +-----+   +-+ | +---+ | | +---------------------------------------|-----------------|-+ | | | | \n" +
        "     |     | | |     |   |       |             | | | |         |   | |           | |   |       |       | |     |   |   |     | | | |   |           |   |       |   |       |   | |     |     | | | | | | \n" +
        "     |     | | |     |   |       |             | | | |         |   | |           | |   |       | +-----|-|---------|---|-----|-|-|-----|---------+ |   |       |   | +-----|--V--|---+ |     | | | | | | \n" +
        "     |     | | |     |   |       |             | | | |         |   | |           | |   |       | |     | |     |   |   |     | | | |   |         | |   |       |   | |     |   | |   | |     | | | | | | \n" +
        " +---|-+   | +-|-----|-------------------------|-----|-------------|-------------|-----|-----+ | |     | +-----|---|-------------------|---------|---+ |       |   | |     |   | | +-+ | +-----+ | | | | \n" +
        " |   | |   |   |     |   |       |             | | | |         |   | |           | |   |     | | |     |       |   |   |     | | | |   |         | | | |       |   | |     |   | | |   | |   |   | | | | \n" +
        " |   | |   |   |     |   |       |             | | | +---------|-----|-----------|-|---------|-|-|-----+       |   | +-|---------|-----|---------+ +-|-|-----------+ |     |   | | |   | |   |   | | | | \n" +
        " |   | |   |   |     |   |       |             | | |           |   | |           | |   |     | | |             |   | | |     | | | |   |             | |       |     |     |   | | |   | |   |   | | | | \n" +
        " |   +-|-----------------|-------|---------------------------------|-+           +-----|-----|-|-+             |   | | |     | | | |   |             | |       |     |     |   | | |   | |   |   | | | | \n" +
        " |     |   |   |     |   |       |             | | |           |   |               |   |     | |               |   | | |     | | | |   |             | |       |     |     |   | | |   | |   |   | | | | \n" +
        " |     |   |   |     |   |       |             | | |           |   +-------------------------------------------+   | +-|-------|---+   |             | |       |     |   +-|-----|-|---|-----|---+ | | | \n" +
        " |     |   |   |     |   |       |             | | |           |                   |   |     | |                   |   |     | | |     |             | |       |     |   | |   | | |   | |   |     | | | \n" +
        " +-----------------------|-------|-------------------------------------------------|---------|---+                 |   +-----|-+ |     |             | |       |     |   | +---|---|-----+   |     | | | \n" +
        "       |   |   |     |   |       |             | | |           |                   |   |     | | |                 |         |   |     |             | |       |     |   |     | | |   |     |     | | | \n" +
        "       |   |   |     |   |       |             | | |           |                   |   |     +-|-|-----------------|-------+ |   |     |             | +-------|---------------|-------------|-----|-|-+ \n" +
        "       |   |   |     |   |       |             | | |           |                   |   |       | |                 |       | |   |     |             |         |     |   |     | | |   |     |     | |   \n" +
        "       +---+   |     |   |       +-------------|-|-|-----------------------------+ +---|-------|-------------------|---------|---------|-------------|-+       |     +---|-------+ |   |     |     | |   \n" +
        "               |     |   |                     | | |           |                 |     |       | |                 |       | |   |     |             | |       |         |     |   |   |     |     | |   \n" +
        "         +---------+ |   |                     | +-|-----------|-----------------------|-----------------------------------|-|---------|-+       +---|---------|---------|-----+   |   |     |     | |   \n" +
        "         |     |   | |   |                     |   |           |                 |     |       | |                 |       | |   |     | |       |   | |       |         |         |   |     |     | |   \n" +
        "         |   +-------+   |                     |   +-----------|---------------------------------|---------------------------|---|-----|-|-------------------------------|-------------|-----|-----|-+   \n" +
        "         |   | |   |     |                     |               |                 |     |       | |                 |       | |   |     | |       |   | |       |         |         |   |     |     |     \n" +
        "         +---+ |   |     |                     +---------------+                 +-----+       +-+         +-------+       | +---|-----|-|-------|-------------------------------------|-+   +-----+     \n" +
        "               |   |     |                                                                                 |               |     |     | |       |   | |       |         |         |   | |               \n" +
        "               |   |     |         +-----------------------------------------------------------------------+               +-----|-------|-----------|-|-------+         |         +-----+               \n" +
        "               |   |     |         |                                                                                             |     | |       |   | |                 |             |                 \n" +
        "   +-----------|---+     |         |                     +-----------------------------------------------------------------------|-------+       |   +---------------------------------|---------------+ \n" +
        "   |           |         |         |                     |                                                                       |     |         |     |                 |             |               | \n" +
        "   +---+ +-----+ +---------------------------------------|-----------------------------------------------------------------------|-----|-----------------------------------------------|---------------+ \n" +
        "       | |       |       |         |                     |                                                                       |     |         |     |                 |             |                 \n" +
        "       | |       +-----------------|---------------------------------------------------------------------------------------------------+ +---------------------------------+           +---------------+ \n" +
        "       | |               |         |                     |                                                                       |       |       |     |                 | |                           | \n" +
        "       +-+               +---------+                     +-----------------------------------------------------------------------+       +-------+     +-----------------+ +---------------------------+ \n" +
        "                                                                                                                                                                                                         "